<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fetch & AJAX Example</title>
  <style>
    body { 
    font-family: Arial; 
    padding: 20px; 
    }
    button { 
    margin: 5px; 
    padding: 5px 10px; 
    cursor: pointer; 
    }
    #users { 
    margin-top: 20px; 
    }
    .user { 
    margin-bottom: 10px; 
    border-bottom: 1px solid #ccc; 
    padding-bottom: 5px; 
    }
  </style>
</head>
<body>
  <h2>User Management (Fetch & AJAX Demo)</h2>

  <button onclick="fetchUsers()">Fetch Users (Fetch API)</button>
  <button onclick="fetchUsersXHR()">Fetch Users (XMLHttpRequest)</button>

  <h3>Add New User</h3>
  <input type="text" id="name" placeholder="Name">
  <input type="text" id="email" placeholder="Email">
  <button onclick="addUser()">Add User</button>

  <div id="users"></div>

  <script>
    const usersDiv = document.getElementById("users");

    //  Fetch API GET request (async + Promise)
    async function fetchUsers() {  //to get user data from server without reloading the page.
      usersDiv.innerHTML = "Loading users..."; //Before fetching starts, we show a message in the <div id="users"> area saying “Loading users…”.
      try {
        const response = await fetch("https://jsonplaceholder.typicode.com/users");
        const data = await response.json(); // JSON → JS object
        displayUsers(data, "Fetch API");  //data → the list of users ,"Fetch API" → to show which method was used
      } catch (error) {
        usersDiv.innerHTML = "Error fetching users: " + error;
      }
    }

    //  XMLHttpRequest GET request (old AJAX way)
    function fetchUsersXHR() {
      usersDiv.innerHTML = "Loading users (XHR)...";
      const xhr = new XMLHttpRequest();
      xhr.open("GET", "https://jsonplaceholder.typicode.com/users", true);
      xhr.onload = function() {
        if(xhr.status === 200) {  //200 na success response
          const data = JSON.parse(xhr.responseText); // raw text form of response (string format)
          displayUsers(data, "XMLHttpRequest");  //converted data display separate function call
        } else {
          usersDiv.innerHTML = "Error fetching users (XHR)";
        }
      };
      xhr.send();
    }

    // Display user list
    function displayUsers(users, method) {
      usersDiv.innerHTML = `<h3>Users (Fetched via ${method})</h3>`;
      users.forEach(user => {
        const div = document.createElement("div");
        div.className = "user";
        div.innerHTML = `<b>${user.name}</b> - ${user.email}`;
        usersDiv.appendChild(div);
      });
    }

    //  Fetch API POST request with headers & JSON
    async function addUser() {
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;

      if(!name || !email){
        alert("Please enter name and email");
        return;
      }

      try {
        const response = await fetch("https://jsonplaceholder.typicode.com/users", {
          method: "POST",
          headers: {
            "Content-Type": "application/json" // tell server it’s JSON
          },
          body: JSON.stringify({ name, email }) // JS object → JSON string
        });
        const data = await response.json();
        alert(`User added! ID: ${data.id}\nName: ${data.name}\nEmail: ${data.email}`);
        document.getElementById("name").value = "";
        document.getElementById("email").value = "";
        fetchUsers(); // refresh list
      } catch (error) {
        alert("Error adding user: " + error);
      }
    }
  </script>
</body>
</html>
